import{n as I,c as h,o as g,a as r,w as N,v as C,F as E,r as R,b as V,t as j,d as M,e as J,f as q}from"./vendor-Ch7-ZM_D.js";import{E as K}from"./pdf-libs-Dsvz6TSF.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function m(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(o){if(o.ep)return;o.ep=!0;const s=m(o);fetch(o.href,s)}})();const O=(e,t)=>{const m=e.__vccOpts||e;for(const[a,o]of t)m[a]=o;return m},Q={data(){return{unitName:"",month:"",recorder:"",className:"",domains:[{name:"身體動作",image:[],description:""},{name:"社會情緒",image:[],description:""},{name:"語言溝通",image:[],description:""},{name:"認知探索",image:[],description:""},{name:"生活自理",image:[],description:""},{name:"教玩具操作 / 文化藝術",image:[],description:""}]}},methods:{checkDescriptionLength(e){e.description.length>60&&(alert("說明欄位最多 60 個字！"),e.description=e.description.substring(0,60))},validateDescription(e){!e||!e.description||e.description.length>60&&alert("說明欄位最多 60 個字！")},handleFileUpload(e,t){const m=Array.from(e.target.files);if(!m.length)return;const a=["image/jpeg","image/png","image/jpg"];this.domains[t].images||(this.domains[t].images=[]);let o=this.domains[t].images.length,s=2-o;if(o>=2){alert("最多只能上傳 2 張圖片");return}m.slice(0,s).forEach(n=>{if(!a.includes(n.type)){alert("僅支援 JPG、JPEG、PNG 格式的圖片"),e.target.value="";return}const i=new FileReader;i.onload=d=>{this.domains[t].images.push(d.target.result)},i.readAsDataURL(n)}),e.target.value=null},removeImage(e,t){this.domains[e].images.splice(t,1)},async loadFont(e){const m=`/teacher-upload/fonts/${e}`,a=await fetch(m);if(!a.ok)throw new Error(`Failed to load font: ${m}`);const o=await a.arrayBuffer(),s=new Uint8Array(o).reduce((n,i)=>n+String.fromCharCode(i),"");return btoa(s)},async generatePDF(){await I();const e=new K("p","mm","a4"),t=await this.loadFont("NotoSansTC-Regular.ttf"),m=await this.loadFont("NotoSansTC-Bold.ttf");if(!t||!m)throw new Error("字體載入失敗，字體資料為空");e.addFileToVFS("NotoSansTC-Regular.ttf",t),e.addFont("NotoSansTC-Regular.ttf","NotoSansTC","normal"),e.addFileToVFS("NotoSansTC-Bold.ttf",m),e.addFont("NotoSansTC-Bold.ttf","NotoSansTC-Bold","bold"),e.setFont("NotoSansTC-Bold","bold");let a=15;e.setFontSize(18),e.text("臺北市私立長藤托嬰中心",70,a),e.setFont("NotoSansTC","normal"),e.setFontSize(12),e.text(`單元名稱: ${this.unitName}`,10,a+15);let o=70,s=110,n=150;e.text(`年月: ${this.month}`,o,a+15),e.text(`班級: ${this.className}`,s,a+15),e.text(`記錄者: ${this.recorder}`,n,a+15);const i=10,d=a+20,l=[35,85,70],x=6,u=40,A=l.reduce((c,p)=>c+p,0),b=this.domains.length;e.setLineWidth(.5),e.rect(i,d,l.reduce((c,p)=>c+p,0),6+u*b),e.setFont("NotoSansTC-Bold","bold"),e.setFontSize(12);let z=i+l[0]/2,$=i+l[0]+l[1]/2,H=i+l[0]+l[1]+l[2]/2,P=d+x-1.5;e.text("發展領域",z,P,{align:"center"}),e.text("照片",$,P,{align:"center"}),e.text("說明",H,P,{align:"center"});for(let c=0;c<b;c++){let p=d+x+c*u;e.line(i,p,i+A,p),e.setFont("NotoSansTC-Bold","bold"),e.setFontSize(12);let y=i+l[0]/2,w=p+u/2,T=e.splitTextToSize(this.domains[c].name,l[0]-10);e.text(T,y,w,{align:"center",baseline:"middle"});let _=this.domains[c].description.substring(0,60),v=l[2]-4,f=e.splitTextToSize(_,v),S=7,L=f.length*S,F=p+(u-L)/2+S/2,D=i+l[0]+l[1]+l[2]/2;e.setFont("NotoSansTC","normal"),e.setFontSize(10),e.text(f,D,F,{align:"center",baseline:"middle"})}let U=i;for(let c of l)U+=c,e.line(U,d,U,d+x+u*b);for(let c=0;c<b;c++){let p=d+x+c*u,y=l[1]/2-3,w=u-6,T=i+l[0]+2,_=T+y+1.5,v=this.domains[c].images||[];for(let f=0;f<v.length;f++){let S=v[f],L=S.includes("image/png")?"PNG":"JPEG",F=new Image;F.src=S,await new Promise(D=>{F.onload=()=>{let X=F.width/F.height,k=y,B=y/X;B>w&&(B=w,k=w*X);let Y=p+(u-B)/2,G=f===0?T:_;e.addImage(S,L,G,Y,k,B),D()}})}}let W=`發展領域記錄表-${this.month}-${this.recorder}.pdf`;e.save(W)}}},Z={class:"container"},ee={class:"card"},te={class:"form-group"},oe={class:"card"},ne={class:"file-label"},se=["onChange"],re={key:0,class:"image-preview"},le=["src"],ie=["onClick"],ae=["onUpdate:modelValue","onInput","onBlur"],de={key:1,class:"error"};function ce(e,t,m,a,o,s){return g(),h("div",Z,[t[13]||(t[13]=r("h1",null,"六大發展領域記錄表",-1)),r("section",ee,[t[11]||(t[11]=r("h2",null,"Step 1: 填寫班級資料",-1)),r("div",te,[t[5]||(t[5]=r("label",null,"單元名稱",-1)),N(r("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=n=>o.unitName=n),maxlength:"5",placeholder:"輸入單元名稱"},null,512),[[C,o.unitName]]),t[6]||(t[6]=r("small",{class:"error"},"最多只能輸入5個字",-1)),t[7]||(t[7]=r("label",null,"年+月份",-1)),N(r("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=n=>o.month=n),placeholder:"輸入年+月份"},null,512),[[C,o.month]]),t[8]||(t[8]=r("small",{class:"example"},"ex: 114年3月",-1)),t[9]||(t[9]=r("label",null,"班級",-1)),N(r("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=n=>o.className=n),placeholder:"輸入班級"},null,512),[[C,o.className]]),t[10]||(t[10]=r("label",null,"記錄者",-1)),N(r("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=n=>o.recorder=n),placeholder:"輸入記錄者"},null,512),[[C,o.recorder]])])]),r("section",oe,[t[12]||(t[12]=r("h2",null,"Step 2: 上傳六大發展領域資料",-1)),(g(!0),h(E,null,R(o.domains,(n,i)=>(g(),h("div",{key:i,class:"domain-card"},[r("h3",null,j(n.name),1),r("label",ne,[r("input",{type:"file",accept:"image/jpeg, image/png",onChange:d=>s.handleFileUpload(d,i),multiple:""},null,40,se)]),(n.images||[]).length?(g(),h("div",re,[(g(!0),h(E,null,R(n.images||[],(d,l)=>(g(),h("div",{key:l,class:"image-wrapper"},[r("img",{src:d,alt:"上傳圖片",width:"200px"},null,8,le),r("button",{onClick:x=>s.removeImage(i,l),class:"delete-btn"}," 🗑️ ",8,ie)]))),128))])):V("",!0),N(r("textarea",{"onUpdate:modelValue":d=>n.description=d,onInput:d=>s.checkDescriptionLength(n),onBlur:d=>s.validateDescription(n),placeholder:"請輸入發展領域說明",maxlength:"60",rows:"3"},null,40,ae),[[C,n.description]]),n.description.length>=60?(g(),h("small",de,"⚠️ 最多只能輸入 60 個字！")):V("",!0)]))),128))]),r("button",{class:"pdf-button",onClick:t[4]||(t[4]=(...n)=>s.generatePDF&&s.generatePDF(...n))},"📄 產生 PDF")])}const me=O(Q,[["render",ce]]),pe={components:{UploadForm:me}};function ue(e,t,m,a,o,s){const n=M("UploadForm");return g(),J(n)}const ge=O(pe,[["render",ue]]);q(ge).mount("#app");
