import{n as M,c as x,o as h,a as s,w as N,v as P,F as V,r as j,b as z,t as $,d as J,e as q,f as K}from"./vendor-Ch7-ZM_D.js";import{_ as Q}from"./pdf-libs-BJUIRQl4.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))m(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&m(n)}).observe(document,{childList:!0,subtree:!0});function c(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function m(t){if(t.ep)return;t.ep=!0;const o=c(t);fetch(t.href,o)}})();const E=(l,e)=>{const c=l.__vccOpts||l;for(const[m,t]of e)c[m]=t;return c},Z={data(){return{unitName:"",month:"",recorder:"",className:"",domains:[{name:"身體動作",image:[],description:""},{name:"社會情緒",image:[],description:""},{name:"語言溝通",image:[],description:""},{name:"認知探索",image:[],description:""},{name:"生活自理",image:[],description:""},{name:"教玩具操作 / 文化藝術",image:[],description:""}]}},methods:{checkDescriptionLength(l){l.description.length>60&&(alert("說明欄位最多 60 個字！"),l.description=l.description.substring(0,60))},validateDescription(l){!l||!l.description||l.description.length>60&&alert("說明欄位最多 60 個字！")},handleFileUpload(l,e){const c=Array.from(l.target.files);if(!c.length)return;const m=["image/jpeg","image/png","image/jpg"];this.domains[e].images||(this.domains[e].images=[]);let t=this.domains[e].images.length,o=2-t;if(t>=2){alert("最多只能上傳 2 張圖片");return}c.slice(0,o).forEach(n=>{if(!m.includes(n.type)){alert("僅支援 JPG、JPEG、PNG 格式的圖片"),l.target.value="";return}const u=new FileReader;u.onload=r=>{this.domains[e].images.push(r.target.result)},u.readAsDataURL(n)}),l.target.value=null},removeImage(l,e){this.domains[l].images.splice(e,1)},async generatePDF(){await M();const{jsPDF:l}=await Q(async()=>{const{jsPDF:a}=await import("./pdf-libs-BJUIRQl4.js").then(d=>d.j);return{jsPDF:a}},[]),e=new l("p","mm","a4"),c="/teacher-upload/fonts/NotoSansTC-Regular.ttf",m="/teacher-upload/fonts/NotoSansTC-Bold.ttf";e.addFont(c,"NotoSansTC","normal"),e.addFont(m,"NotoSansTC-Bold","normal"),e.setFont("NotoSansTC-Bold");let t=15;e.setFontSize(18),e.text("臺北市私立長藤托嬰中心",70,t),e.setFont("NotoSansTC"),e.setFontSize(12),e.text(`單元名稱: ${this.unitName}`,10,t+15);let o=70,n=110,u=150;e.text(`年月: ${this.month}`,o,t+15),e.text(`班級: ${this.className}`,n,t+15),e.text(`記錄者: ${this.recorder}`,u,t+15);const r=10,p=t+20,i=[35,85,70],w=6,g=40,A=i.reduce((a,d)=>a+d,0),C=this.domains.length;e.setLineWidth(.5),e.rect(r,p,i.reduce((a,d)=>a+d,0),6+g*C),e.setFont("NotoSansTC-Bold"),e.setFontSize(12);let H=r+i[0]/2,I=r+i[0]+i[1]/2,R=r+i[0]+i[1]+i[2]/2,D=p+w-1.5;e.text("發展領域",H,D,{align:"center"}),e.text("照片",I,D,{align:"center"}),e.text("說明",R,D,{align:"center"});for(let a=0;a<C;a++){let d=p+w+a*g;e.line(r,d,r+A,d),e.setFont("NotoSansTC-Bold"),e.setFontSize(12);let S=r+i[0]/2,v=d+g/2,b=e.splitTextToSize(this.domains[a].name,i[0]-10);e.text(b,S,v,{align:"center",baseline:"middle"});let L=this.domains[a].description.substring(0,60),T=i[2]-4,f=e.splitTextToSize(L,T),F=7,U=f.length*F,y=d+(g-U)/2+F/2,X=r+i[0]+i[1]+i[2]/2;e.setFont("NotoSansTC"),e.setFontSize(10),e.text(f,X,y,{align:"center",baseline:"middle"})}let B=r;for(let a of i)B+=a,e.line(B,p,B,p+w+g*C);for(let a=0;a<C;a++){let d=p+w+a*g,S=i[1]/2-3,v=g-6,b=r+i[0]+2,L=b+S+1.5,T=this.domains[a].images||[];for(let f=0;f<T.length;f++){let F=T[f],U=F.includes("image/png")?"PNG":"JPEG",y=new Image;y.src=F,await new Promise(X=>{y.onload=()=>{let O=y.width/y.height,k=S,_=S/O;_>v&&(_=v,k=v*O);let Y=d+(g-_)/2,G=f===0?b:L;e.addImage(F,U,G,Y,k,_),X()}})}}let W=`發展領域記錄表-${this.month}-${this.recorder}.pdf`;e.save(W)}}},ee={class:"container"},te={class:"card"},ne={class:"form-group"},oe={class:"card"},se={class:"file-label"},le=["onChange"],re={key:0,class:"image-preview"},ie=["src"],ae=["onClick"],de=["onUpdate:modelValue","onInput","onBlur"],ce={key:1,class:"error"};function me(l,e,c,m,t,o){return h(),x("div",ee,[e[13]||(e[13]=s("h1",null,"六大發展領域記錄表",-1)),s("section",te,[e[11]||(e[11]=s("h2",null,"Step 1: 填寫班級資料",-1)),s("div",ne,[e[5]||(e[5]=s("label",null,"單元名稱",-1)),N(s("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=n=>t.unitName=n),maxlength:"5",placeholder:"輸入單元名稱"},null,512),[[P,t.unitName]]),e[6]||(e[6]=s("small",{class:"error"},"最多只能輸入5個字",-1)),e[7]||(e[7]=s("label",null,"年+月份",-1)),N(s("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=n=>t.month=n),placeholder:"輸入年+月份"},null,512),[[P,t.month]]),e[8]||(e[8]=s("small",{class:"example"},"ex: 114年3月",-1)),e[9]||(e[9]=s("label",null,"班級",-1)),N(s("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=n=>t.className=n),placeholder:"輸入班級"},null,512),[[P,t.className]]),e[10]||(e[10]=s("label",null,"記錄者",-1)),N(s("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=n=>t.recorder=n),placeholder:"輸入記錄者"},null,512),[[P,t.recorder]])])]),s("section",oe,[e[12]||(e[12]=s("h2",null,"Step 2: 上傳六大發展領域資料",-1)),(h(!0),x(V,null,j(t.domains,(n,u)=>(h(),x("div",{key:u,class:"domain-card"},[s("h3",null,$(n.name),1),s("label",se,[s("input",{type:"file",accept:"image/jpeg, image/png",onChange:r=>o.handleFileUpload(r,u),multiple:""},null,40,le)]),(n.images||[]).length?(h(),x("div",re,[(h(!0),x(V,null,j(n.images||[],(r,p)=>(h(),x("div",{key:p,class:"image-wrapper"},[s("img",{src:r,alt:"上傳圖片",width:"200px"},null,8,ie),s("button",{onClick:i=>o.removeImage(u,p),class:"delete-btn"}," 🗑️ ",8,ae)]))),128))])):z("",!0),N(s("textarea",{"onUpdate:modelValue":r=>n.description=r,onInput:r=>o.checkDescriptionLength(n),onBlur:r=>o.validateDescription(n),placeholder:"請輸入發展領域說明",maxlength:"60",rows:"3"},null,40,de),[[P,n.description]]),n.description.length>=60?(h(),x("small",ce,"⚠️ 最多只能輸入 60 個字！")):z("",!0)]))),128))]),s("button",{class:"pdf-button",onClick:e[4]||(e[4]=(...n)=>o.generatePDF&&o.generatePDF(...n))},"📄 產生 PDF")])}const pe=E(Z,[["render",me]]),ue={components:{UploadForm:pe}};function ge(l,e,c,m,t,o){const n=J("UploadForm");return h(),q(n)}const he=E(ue,[["render",ge]]);K(he).mount("#app");
